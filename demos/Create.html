<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create</title>
</head>
<body>
<link href="../src/nimiq-style.css" rel="stylesheet">
<script src="http://cdn.nimiq.com/web-offline.js"></script>
<script src="../src/lib/EncryptionType.js"></script>

<div>
    <button id="high">Create account with high encryption type</button>
    <button id="low">Create account with low encryption type</button>
</div>

<script>
    (async () => {
        // Because the mocked KeyStore.prototype.get function below is defined in this
        // window's scope, Nimiq also needs to be defined and initialized here
        await Nimiq.WasmHelper.doImportBrowser();
        Nimiq.GenesisConfig.test();
    })();

    document.querySelector('button#high').addEventListener('click', async () => {

        const keyguard = window.open('../src/request/create/');

        // We need this check because we call the rpcServer object directly and not via RPC Client
        function checkIfKeyguardReady(resolve) {
            if (keyguard.rpcServer !== undefined) {
                resolve();
            } else {
                self.setTimeout(() => checkIfKeyguardReady(resolve), 25);
            }
        }

        await new Promise(res => checkIfKeyguardReady(res));

        const createRequest = {
            type: EncryptionType.HIGH
        };

        const result = await keyguard.rpcServer.request(createRequest);

        if (result) {
            console.log(result);
            keyguard.close();
        }
    });
</script>

</body>
</html>
